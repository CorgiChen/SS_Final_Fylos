{"version":3,"sources":["assets\\Script\\Transport.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Door_to_002 extends cc.Component {\r\n    @property(cc.Node)\r\n    player: cc.Node = null;\r\n    @property(cc.Node)\r\n    door: cc.Node = null;\r\n    @property(cc.SpriteFrame)\r\n    doorSpriteFrame: cc.SpriteFrame = null;\r\n    @property(cc.SpriteFrame)\r\n    promptSpriteFrame: cc.SpriteFrame = null;\r\n    @property\r\n    destinationScene: string = \"\";\r\n\r\n    private readonly DETECTION_RADIUS: number = 70;\r\n    private readonly DOOR_OFFSET: number = 120;\r\n    private lastDoorState: boolean = false;\r\n    private promptImage: cc.Node = null;\r\n\r\n    onLoad() {\r\n        if (!this.player || !this.door || !this.doorSpriteFrame || !this.promptSpriteFrame) {\r\n            cc.error(\"Please assign all required components!\");\r\n            return;\r\n        }\r\n\r\n        // 關閉碰撞區域的顯示\r\n        const physicsManager = cc.director.getPhysicsManager();\r\n        if (physicsManager) {\r\n            physicsManager.debugDrawFlags = 0;\r\n        }\r\n\r\n        this.setupDoor();\r\n        this.createPromptImage();\r\n    }\r\n\r\n    private setupDoor() {\r\n        // 添加 Sprite 組件\r\n        const sprite = this.door.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = this.doorSpriteFrame;\r\n    }\r\n\r\n    private createPromptImage() {\r\n        // 創建提示圖片節點\r\n        this.promptImage = new cc.Node('Prompt_Image');\r\n        \r\n        // 添加 Sprite 組件\r\n        const sprite = this.promptImage.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = this.promptSpriteFrame;\r\n        \r\n        // 添加按鈕組件\r\n        const button = this.promptImage.addComponent(cc.Button);\r\n        \r\n        // 設置父節點為門\r\n        this.promptImage.parent = this.door;\r\n        \r\n        // 設置位置在門的正上方\r\n        this.promptImage.setPosition(cc.v2(0, this.DOOR_OFFSET + 60));\r\n        \r\n        // 確保圖片在最上層\r\n        this.promptImage.zIndex = 1000;\r\n        \r\n        // 初始時隱藏圖片\r\n        this.promptImage.active = false;\r\n\r\n        // 添加點擊事件\r\n        this.promptImage.on(cc.Node.EventType.TOUCH_END, this.onPromptClicked, this);\r\n    }\r\n\r\n    private onPromptClicked() {\r\n        // 切換到場景 Scene002_Home_1F\r\n        cc.director.loadScene(this.destinationScene);\r\n    }\r\n\r\n    update() {\r\n        if (!this.player || !this.door || !this.promptImage) return;\r\n\r\n        // 將 Vec3 轉換為 Vec2\r\n        const playerPos = new cc.Vec2(this.player.position.x, this.player.position.y);\r\n        const doorPos = new cc.Vec2(this.door.position.x, this.door.position.y);\r\n\r\n        // 計算玩家和門的距離\r\n        const distance = this.getDistance(playerPos, doorPos);\r\n        const shouldShow = distance <= this.DETECTION_RADIUS;\r\n\r\n        // 根據距離顯示或隱藏提示圖片\r\n        if (this.promptImage.active !== shouldShow) {\r\n            this.promptImage.active = shouldShow;\r\n            if (shouldShow) {\r\n                // 確保提示圖片在最上層\r\n                this.promptImage.zIndex = 1000;\r\n            }\r\n        }\r\n    }\r\n\r\n    private getDistance(pos1: cc.Vec2, pos2: cc.Vec2): number {\r\n        const dx = pos1.x - pos2.x;\r\n        const dy = pos1.y - pos2.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    onDestroy() {\r\n        if (this.promptImage) {\r\n            this.promptImage.off(cc.Node.EventType.TOUCH_END, this.onPromptClicked, this);\r\n            this.promptImage.destroy();\r\n        }\r\n    }\r\n} "]}