{"version":3,"sources":["assets\\Script\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\nimport AudioManager from './AudioManager';\r\n\r\n@ccclass\r\nexport default class PlayerController extends cc.Component {\r\n    moveSpeed: number = 300;\r\n    jumpForce: number = 850;\r\n    gravity: number = 1500;\r\n    maxFallSpeed: number = 800;\r\n    groundY: number = -300;\r\n\r\n    public moveDirection: number = 0;\r\n    private onGround: boolean = false;\r\n    private isJumping: boolean = false;\r\n    private isFalling: boolean = false;\r\n    private anim: cc.Animation = null;\r\n    private verticalVelocity: number = 0;\r\n    private horizontalVelocity: number = 0;\r\n    private rigidbody: cc.RigidBody = null;\r\n    private collider: cc.PhysicsBoxCollider = null;\r\n    private currentAnimation: string = \"idle\";\r\n    private groundCheckDistance: number = 10;\r\n    private lastVerticalVelocity: number = 0; \r\n    private footstepSoundId: number = -1; \r\n    private lastFootstepTime: number = 0;\r\n    private footstepInterval: number = 0.3; \r\n    private isDied: boolean = false;\r\n    \r\n\r\n    @property(cc.AudioClip)\r\n    footstepSound: cc.AudioClip = null;  // 走路音效\r\n\r\n    @property(cc.AudioClip)\r\n    jumpSound: cc.AudioClip = null;  // 跳跃音效\r\n\r\n    @property({ type: cc.AudioClip })\r\n    dieSound: cc.AudioClip = null; // 新增：死亡音效\r\n\r\n    onLoad() {\r\n        this.isDied = false;\r\n        cc.director.getCollisionManager().enabled = true;\r\n        // 初始化物理系統\r\n        const manager = cc.director.getPhysicsManager();\r\n        manager.enabled = true;\r\n        manager.gravity = cc.v2(0, -1200);\r\n        manager.debugDrawFlags = 0;  // 關閉碰撞顯示\r\n\r\n        // 獲取組件\r\n        this.anim = this.getComponent(cc.Animation);\r\n        if (this.anim) {\r\n            const clips = this.anim.getClips();\r\n            clips.forEach(clip => {\r\n                clip.wrapMode = cc.WrapMode.Loop;\r\n            });\r\n        }\r\n\r\n        // 初始化物理組件\r\n        this.rigidbody = this.getComponent(cc.RigidBody);\r\n        this.collider = this.getComponent(cc.PhysicsBoxCollider);\r\n\r\n        if (this.rigidbody) {\r\n            this.rigidbody.type = cc.RigidBodyType.Dynamic;\r\n            this.rigidbody.fixedRotation = true;\r\n            this.rigidbody.enabledContactListener = true;\r\n            this.rigidbody.gravityScale = 0;\r\n            this.rigidbody.linearDamping = 0;\r\n            this.rigidbody.allowSleep = false;\r\n        }\r\n\r\n        if (this.collider) {\r\n            this.collider.enabled = true;\r\n            this.collider.sensor = false;\r\n            this.collider.friction = 0.3;\r\n            this.collider.restitution = 0;\r\n\r\n            // 調整碰撞箱大小\r\n            const size = this.node.getContentSize();\r\n            this.collider.size = cc.size(size.width * 0.8, size.height * 0.8);\r\n            this.collider.offset = cc.v2(0, -size.height * 0.1);\r\n        }\r\n\r\n        // 註冊鍵盤事件\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n        // 預設播放待機動畫\r\n        if (this.anim) {\r\n            this.anim.play(\"idle\");\r\n        }\r\n    }\r\n\r\n    private playAnimation(animName: string) {\r\n        if (this.isDied) return;\r\n        if (this.anim && this.currentAnimation !== animName) {\r\n            const state = this.anim.getAnimationState(animName);\r\n            if (state) {\r\n                state.wrapMode = cc.WrapMode.Loop;\r\n                state.speed = 1.0;\r\n                this.anim.play(animName);\r\n                this.currentAnimation = animName;\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        if (this.isDied) return;\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.left:\r\n            case cc.macro.KEY.a:\r\n                this.moveDirection = -1;\r\n                this.horizontalVelocity = -this.moveSpeed;\r\n                if (!this.isJumping) {\r\n                    this.playAnimation(\"move\");\r\n                }\r\n                if (this.node.scaleX > 0 && !cc.director.isPaused()) {\r\n                    this.node.scaleX *= -1;\r\n                }\r\n                break;\r\n            case cc.macro.KEY.right:\r\n            case cc.macro.KEY.d:\r\n                this.moveDirection = 1;\r\n                this.horizontalVelocity = this.moveSpeed;\r\n                if (!this.isJumping) {\r\n                    this.playAnimation(\"move\");\r\n                }\r\n                if (this.node.scaleX < 0 && !cc.director.isPaused()) {\r\n                    this.node.scaleX *= -1;\r\n                }\r\n                break;\r\n            case cc.macro.KEY.up:\r\n            case cc.macro.KEY.space:\r\n                if (this.onGround) {\r\n                    this.jump();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp(event: cc.Event.EventKeyboard) {\r\n        if (this.isDied) return;\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.left:\r\n            case cc.macro.KEY.a:\r\n                if (this.moveDirection < 0) {\r\n                    this.moveDirection = 0;\r\n                    this.horizontalVelocity = 0;\r\n                    if (!this.isJumping) {\r\n                        this.playAnimation(\"idle\");\r\n                        this.stopFootstepSound();  // 停止走路音效\r\n                    }\r\n                }\r\n                break;\r\n            case cc.macro.KEY.right:\r\n            case cc.macro.KEY.d:\r\n                if (this.moveDirection > 0) {\r\n                    this.moveDirection = 0;\r\n                    this.horizontalVelocity = 0;\r\n                    if (!this.isJumping) {\r\n                        this.playAnimation(\"idle\");\r\n                        this.stopFootstepSound();  // 停止走路音效\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private playJumpSound() {\r\n        if (this.jumpSound) {\r\n            cc.audioEngine.play(this.jumpSound, false, cc.audioEngine.getVolume(AudioManager.audioId));\r\n        }\r\n    }\r\n\r\n    jump() {\r\n        if (this.onGround) {\r\n            this.onGround = false;\r\n            this.isJumping = true;\r\n            this.isFalling = false;\r\n            this.verticalVelocity = this.jumpForce;\r\n            this.playAnimation(\"jump\");\r\n            this.playJumpSound();  // 播放跳跃音效\r\n        }\r\n    }\r\n\r\n    onBeginContact(contact: cc.PhysicsContact, selfCollider: cc.PhysicsCollider, otherCollider: cc.PhysicsCollider) {\r\n        if (otherCollider.node.name === 'Ground') {\r\n            const normal = contact.getWorldManifold().normal;\r\n            \r\n            if (normal.y < 0) {\r\n                this.onGround = true;\r\n                this.isJumping = false;\r\n                this.isFalling = false;\r\n                this.verticalVelocity = 0;\r\n\r\n                if (this.moveDirection !== 0) {\r\n                    this.playAnimation(\"move\");\r\n                } else {\r\n                    this.playAnimation(\"idle\");\r\n                }\r\n            }\r\n        }\r\n                // 新增：碰到 DieArea 就 reload 當前場景\r\n        if (otherCollider.node.name === 'DieArea') {\r\n            this.isDied = true;\r\n            const sceneName = cc.director.getScene().name;\r\n            // 播放死亡音效\r\n            if (this.dieSound) {\r\n                cc.audioEngine.playEffect(this.dieSound, false);\r\n            }\r\n            // 讓玩家慢慢跌倒（0.5秒內旋轉90度）\r\n            cc.tween(this.node)\r\n                .to(0.5, { angle: 90 })\r\n                .start();\r\n            setTimeout(() => {\r\n                cc.director.loadScene(sceneName);\r\n            }, 2000);\r\n        }\r\n\r\n    }\r\n\r\n    onEndContact(contact: cc.PhysicsContact, selfCollider: cc.PhysicsCollider, otherCollider: cc.PhysicsCollider) {\r\n        if (otherCollider.node.name === 'Ground') {\r\n            const normal = contact.getWorldManifold().normal;\r\n            \r\n            if (normal.y < 0) {\r\n                this.onGround = false;\r\n                if (this.verticalVelocity < 0) {\r\n                    this.isFalling = true;\r\n                    this.playAnimation(\"fall\");\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    private playFootstepSound() {\r\n        const currentTime = Date.now() / 1000;  // 转换为秒\r\n        if (currentTime - this.lastFootstepTime >= this.footstepInterval) {\r\n            if (this.footstepSound) {\r\n                // 如果之前的音效还在播放，先停止它\r\n                if (this.footstepSoundId !== -1) {\r\n                    cc.audioEngine.stop(this.footstepSoundId);\r\n                }\r\n                // 播放新的音效，使用配置的音量\r\n                this.footstepSoundId = cc.audioEngine.play(this.footstepSound, false, cc.audioEngine.getVolume(AudioManager.audioId));\r\n                this.lastFootstepTime = currentTime;\r\n            }\r\n        }\r\n    }\r\n\r\n    private stopFootstepSound() {\r\n        if (this.footstepSoundId !== -1) {\r\n            cc.audioEngine.stop(this.footstepSoundId);\r\n            this.footstepSoundId = -1;\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.isDied) return;\r\n        // 檢查是否在地面上\r\n        if (!this.onGround) {\r\n            const startPos = cc.v2(this.node.position.x, this.node.position.y);\r\n            const rayStart = cc.v2(startPos.x, startPos.y);\r\n            const rayEnd = cc.v2(startPos.x, startPos.y - this.groundCheckDistance);\r\n\r\n            const results = cc.director.getPhysicsManager().rayCast(rayStart, rayEnd, cc.RayCastType.All);\r\n            if (results.length > 0) {\r\n                for (const result of results) {\r\n                    if (result.collider.node.name === 'Ground') {\r\n                        // 確保只有在地面Y座標附近才判定為著地\r\n                        if (Math.abs(result.point.y - this.groundY) < 10) {\r\n                            this.onGround = true;\r\n                            this.isFalling = false;\r\n                            this.isJumping = false;\r\n                            this.verticalVelocity = 0;\r\n                            this.node.y = this.groundY;  // 確保角色位置正確\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // 應用重力\r\n        if (!this.onGround) {\r\n            this.verticalVelocity -= this.gravity * dt;\r\n            if (this.verticalVelocity < -this.maxFallSpeed) {\r\n                this.verticalVelocity = -this.maxFallSpeed;\r\n            }\r\n\r\n            // 檢測跳躍到最高點\r\n            if (this.lastVerticalVelocity > 0 && this.verticalVelocity <= 0) {\r\n                this.isJumping = false;\r\n                this.isFalling = true;\r\n                this.playAnimation(\"fall\");\r\n            }\r\n\r\n            // 更新下落狀態\r\n            if (this.verticalVelocity < 0 && !this.isFalling) {\r\n                this.isFalling = true;\r\n                this.isJumping = false;\r\n                this.playAnimation(\"fall\");\r\n            }\r\n        }\r\n\r\n        // 更新位置\r\n        let newX = this.node.x + this.horizontalVelocity * dt;\r\n        let newY = this.node.y + this.verticalVelocity * dt;\r\n\r\n        // 如果在地面上且正在移动，播放走路音效\r\n        if (this.onGround && this.moveDirection !== 0) {\r\n            this.playFootstepSound();\r\n        } else {\r\n            this.stopFootstepSound();  // 如果不在移动，停止音效\r\n        }\r\n\r\n        // 防止角色掉出地面\r\n        if (newY < this.groundY) {\r\n            newY = this.groundY;\r\n            this.onGround = true;\r\n            this.isFalling = false;\r\n            this.isJumping = false;\r\n            this.verticalVelocity = 0;\r\n        }\r\n\r\n        this.node.setPosition(newX, newY);\r\n\r\n        // 更新動畫\r\n        if (this.anim) {\r\n            if (this.isJumping) {\r\n                this.playAnimation(\"jump\");\r\n            } else if (this.isFalling) {\r\n                this.playAnimation(\"fall\");\r\n            } else if (this.moveDirection !== 0) {\r\n                this.playAnimation(\"move\");\r\n            } else {\r\n                this.playAnimation(\"idle\");\r\n            }\r\n        }\r\n\r\n        // 保存當前垂直速度用於下一幀比較\r\n        this.lastVerticalVelocity = this.verticalVelocity;\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n    }\r\n\r\n    onCollisionEnter(other, self) {\r\n        cc.log('onCollisionEnter:', other.node.name);\r\n        if (other.node.name === \"JumpArea\") {\r\n            cc.tween(self.node)\r\n                .to(0.5, { y: self.node.y + 500 })\r\n                .start();\r\n            cc.log('JumpArea triggered, moving up 500');\r\n        }\r\n    }\r\n}\r\n"]}